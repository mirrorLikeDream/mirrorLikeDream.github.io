import{t as y,f as D,n as w,a6 as ee,af as oe,ad as L,ae as te,k as _,aR as ne,a8 as p,d as N,e as $,r as g,J as j,a as r,a4 as K,T as M,g as G,P as ae,G as F,R as H,S as U,v as V,h as se,l as le,aj as ce,al as re,V as ie,s as A,C as b,ap as de,$ as ue,M as fe,I as ve,ax as ye,aS as me}from"./index-PjOYImKJ.js";import{u as Y}from"./use-lazy-render-apxFokIB.js";import{u as B}from"./use-scope-id-CQTTiy5Q.js";let he=2e3;const Ie=()=>++he,Oe={show:Boolean,zIndex:w,overlay:y,duration:w,teleport:[String,Object],lockScroll:y,lazyRender:y,beforeClose:Function,overlayStyle:Object,overlayClass:D,transitionAppear:Boolean,closeOnClickOverlay:y};let h=0;const E="van-overflow-hidden";function Ce(e,o){const a=ee(),f="01",s="10",c=i=>{a.move(i);const v=a.deltaY.value>0?s:f,S=ne(i.target,e.value),{scrollHeight:m,offsetHeight:O,scrollTop:C}=S;let d="11";C===0?d=O>=m?"00":"01":C+O>=m&&(d="10"),d!=="11"&&a.isVertical()&&!(parseInt(d,2)&parseInt(v,2))&&p(i,!0)},n=()=>{document.addEventListener("touchstart",a.start),document.addEventListener("touchmove",c,{passive:!1}),h||document.body.classList.add(E),h++},l=()=>{h&&(document.removeEventListener("touchstart",a.start),document.removeEventListener("touchmove",c),h--,h||document.body.classList.remove(E))},P=()=>o()&&n(),I=()=>o()&&l();oe(P),L(I),te(I),_(o,i=>{i?n():l()})}const[ke,we]=$("overlay"),Pe={show:Boolean,zIndex:w,duration:w,className:D,lockScroll:y,lazyRender:y,customStyle:Object,teleport:[String,Object]};var Se=N({name:ke,props:Pe,setup(e,{slots:o}){const a=g(),f=Y(()=>e.show||!e.lazyRender),s=n=>{e.lockScroll&&p(n,!0)},c=f(()=>{var n;const l=G(ae(e.zIndex),e.customStyle);return F(e.duration)&&(l.animationDuration=`${e.duration}s`),H(r("div",{ref:a,style:l,class:[we(),e.className]},[(n=o.default)==null?void 0:n.call(o)]),[[U,e.show]])});return j("touchmove",s,{target:a}),()=>{const n=r(K,{name:"van-fade",appear:!0},{default:c});return e.teleport?r(M,{to:e.teleport},{default:()=>[n]}):n}}});const xe=V(Se),be=G({},Oe,{round:Boolean,position:b("center"),closeIcon:b("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:b("top-right"),destroyOnClose:Boolean,safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[ge,R]=$("popup");var Te=N({name:ge,inheritAttrs:!1,props:be,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:o,attrs:a,slots:f}){let s,c;const n=g(),l=g(),P=Y(()=>e.show||!e.lazyRender),I=se(()=>{const t={zIndex:n.value};if(F(e.duration)){const u=e.position==="center"?"animationDuration":"transitionDuration";t[u]=`${e.duration}s`}return t}),i=()=>{s||(s=!0,n.value=e.zIndex!==void 0?+e.zIndex:Ie(),o("open"))},v=()=>{s&&de(e.beforeClose,{done(){s=!1,o("close"),o("update:show",!1)}})},S=t=>{o("clickOverlay",t),e.closeOnClickOverlay&&v()},m=()=>{if(e.overlay)return r(xe,A({show:e.show,class:e.overlayClass,zIndex:n.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},B(),{onClick:S}),{default:f["overlay-content"]})},O=t=>{o("clickCloseIcon",t),v()},C=()=>{if(e.closeable)return r(ve,{role:"button",tabindex:0,name:e.closeIcon,class:[R("close-icon",e.closeIconPosition),fe],classPrefix:e.iconPrefix,onClick:O},null)};let d;const Z=()=>{d&&clearTimeout(d),d=setTimeout(()=>{o("opened")})},J=()=>o("closed"),W=t=>o("keydown",t),q=P(()=>{var t;const{destroyOnClose:u,round:x,position:k,safeAreaInsetTop:Q,safeAreaInsetBottom:X,show:z}=e;if(!(!z&&u))return H(r("div",A({ref:l,style:I.value,role:"dialog",tabindex:0,class:[R({round:x,[k]:k}),{"van-safe-area-top":Q,"van-safe-area-bottom":X}],onKeydown:W},a,B()),[(t=f.default)==null?void 0:t.call(f),C()]),[[U,z]])}),T=()=>{const{position:t,transition:u,transitionAppear:x}=e,k=t==="center"?"van-fade":`van-popup-slide-${t}`;return r(K,{name:u||k,appear:x,onAfterEnter:Z,onAfterLeave:J},{default:q})};return _(()=>e.show,t=>{t&&!s&&(i(),a.tabindex===0&&ue(()=>{var u;(u=l.value)==null||u.focus()})),!t&&s&&(s=!1,o("close"))}),le({popupRef:l}),Ce(l,()=>e.show&&e.lockScroll),j("popstate",()=>{e.closeOnPopstate&&(v(),c=!1)}),ce(()=>{e.show&&i()}),re(()=>{c&&(o("update:show",!0),c=!1)}),L(()=>{e.show&&e.teleport&&(v(),c=!0)}),ye(me,()=>e.show),()=>e.teleport?r(M,{to:e.teleport},{default:()=>[m(),T()]}):r(ie,null,[m(),T()])}});const Ee=V(Te);export{Ee as P};
